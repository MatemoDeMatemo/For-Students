
#### Code that simulates the fate of a given population over the course of 100 years of exploitation (and randomness) ####
"
Start_Population = 1000   # population at the year 0
Years <- 100              # lenght of simulation
Growth_Rate[1] <- 1.1
a <- 0.001          
Env_Cap <- 1000     # capacity of the given environemnt
Exploit_Per <- 0.2  # percent of pop that may be harvested
Exploit_Fixed <- FALSE # Numeric/F Informs us if the exploit is a fixed value or [FALSE] a % of pop
Exploit_Fixed <- 220
"


#### Function that simulates one year for the population with exploitation (and randomness) ####

Symulacja_Populacji <- function(Years = 100, Start_Population = 1000, Start_Growth_Rate = 1.1, a = 0.001, 
                                Env_Cap = 1000, Exploit_Per = 0.1, Exploit_Fixed = 100) {

  Population <- Growth_Rate <- Exploit <- numeric(Years)
  Exploit[Years] <- NA
  Population[1] <- Start_Population
  Growth_Rate[1] <- Start_Growth_Rate
  
  for (i in 1:(Years-1)) {
    
    # Is exploitation a fixed value
    if(is.numeric(Exploit_Fixed) == FALSE){
    Exploit[i] <- Exploit_Per *  Population[i]
    } else{
      Exploit[i] <- Exploit_Fixed
    }
    
    #Random_Factor <- rnorm(1, mean = 1, sd= 0.1)  
    Random_Factor <- rnorm(1, mean = 0, sd= 0.1)  
    Population[i + 1] <- Population[i] * (Growth_Rate[i] * 1) - Exploit[i]
    if (Population[i + 1] < 0) {
      Exploit[i] <- Exploit[i] + Population[i + 1] 
      Population[i + 1] <- 0
    }
    
    #Growth_Rate[i + 1] <- 1 - a * (Population[i] - Env_Cap) * Random_Factor
    Growth_Rate[i + 1] <- 1 - a * (Population[i] - (Env_Cap - (abs(Env_Cap * Random_Factor)))) 
  }
  #plot(Population)
  return(list(pop = Population, exp = Exploit))
}



#####################################################################################################################
################################################## Modeling #########################################################
#####################################################################################################################


### Fixed exploitation - 10000 repeats for each of the exploitation variants ####

Exploit_Var <- seq(0, 300, by = 10)   #   exploitation variants

# data.frame for the results
Results_FIX <- data.frame(Exploit = Exploit_Var,
                          Mean_Population = c(rep(0,length(Exploit_Var))), 
                          Alive = c(rep(0,length(Exploit_Var))),
                          Mean_Profit = c(rep(0,length(Exploit_Var))))


for(i in 1:length(Exploit_Var)){
  
  Repeats = 10000
  Mean_Population <- Is_Dead <-  Mean_Profit<- numeric(Repeats)
  
  
  for(ii in 1:Repeats) { 
    x <- Symulacja_Populacji(Exploit_Fixed = Exploit_Var[i]) # setting the function
    Mean_Population[ii]  <- mean(x$pop)
    Is_Dead[ii]          <- as.numeric(tail(x$pop, n = 1))
    
    if(Is_Dead[ii]>0) {
      Is_Dead[ii]<- 1
    }else{
      Is_Dead[ii] <- 0
      Mean_Population[ii] <- NA}  # dzieki temu nie liczy srednich dla martwych populacji
    
    Mean_Profit[ii]      <- sum(x$exp, na.rm = TRUE)
    
  
  }
  
  Results_FIX$Mean_Population[i] <- mean(Mean_Population, na.rm = TRUE)
  Results_FIX$Alive[i] <- sum(Is_Dead)/Repeats
  Results_FIX$Mean_Profit[i] <- mean(Mean_Profit)
}

Results_FIX








#### Harvesting as a constant % of a population - 10000 repeats for each of the exploitation variants ####

Exploit_Var <- seq(0, 1, by=0.05)     #  exploitation variants

# data.frame for the results
Results_NoFIX <- data.frame(Exploit = Exploit_Var,
                          Mean_Population = c(rep(0,length(Exploit_Var))), 
                          Alive = c(rep(0,length(Exploit_Var))),
                          Mean_Profit = c(rep(0,length(Exploit_Var))))


for(i in 1:length(Exploit_Var)){
  
  Repeats = 10000
  Mean_Population <- Is_Dead <-  Mean_Profit<- numeric(Repeats)
  

  for(ii in 1:Repeats) { 
    x <- Symulacja_Populacji(Exploit_Fixed = FALSE, Exploit_Per = Exploit_Var[i]) # setting the function
    Mean_Population[ii]  <- mean(x$pop)
    Is_Dead[ii]          <- as.numeric(tail(x$pop, n = 1))
    
    if(Is_Dead[ii]>0) {
      Is_Dead[ii]<- 1
    }else{
      Is_Dead[ii] <- 0
      Mean_Population[ii] <- NA}  # dzieki temu nie liczy srednich dla martwych populacji
    
    Mean_Profit[ii]      <- sum(x$exp, na.rm = TRUE) 
    
    
  }

  Results_NoFIX$Mean_Population[i] <- mean(Mean_Population, na.rm = TRUE)
  Results_NoFIX$Alive[i] <- sum(Is_Dead)/Repeats
  Results_NoFIX$Mean_Profit[i] <- mean(Mean_Profit)
}

Results_NoFIX



##################################################################################################################
################################################### Visualisation ################################################
##################################################################################################################


# getting rid off NaN
Results_FIX$Mean_Population[is.nan(Results_FIX$Mean_Population)] <- 0
Results_NoFIX$Mean_Population[is.nan(Results_NoFIX$Mean_Population)] <- 0


### Total Exploit ###

plot(Results_FIX$Exploit,Results_FIX$Mean_Profit, xlab = "Exploit_Level", ylab = "Profit", ylim = c(0, 21000))
points(Results_FIX$Exploit,Results_FIX$Alive*10000, type = 'l', col = 'red')
abline(v  =150, lty = "dashed")


plot(Results_NoFIX$Exploit,Results_NoFIX$Mean_Profit, xlab = "Exploit_Level", ylab = "Profit", ylim = c(0, 21000))
points(Results_NoFIX$Exploit,Results_NoFIX$Alive*10000, type = 'l', col = 'red')
abline(v  =0.65, lty = "dashed")



### Total Population ###

plot(Results_FIX$Exploit,Results_FIX$Mean_Population, ylim = c(-10,1000), xlab = "Exploit", ylab = "Population")
points(Results_FIX$Exploit,Results_FIX$Alive*1000, type = 'l', col = 'red')
abline(v  =150, lty = "dashed")


plot(Results_NoFIX$Exploit,Results_NoFIX$Mean_Population, , ylim = c(0,1000), xlab = "Exploit", ylab = "Population")
points(Results_NoFIX$Exploit,Results_NoFIX$Alive*1000, type = 'l', col = 'red')
abline(v  =0.65, lty = "dashed")






################################################## Legacy code ###################################################

"
Years <- 100
Population <- Growth_Rate <- Exploit <- numeric(Years)
Exploit[Years] <- NA
Population[1] <- 1000
Growth_Rate[1] <- 1.1
a <- 0.001
Env_Cap <- 1000
Exploit_Per <- 0.2 #
Exploit_Fixed <- FALSE # Numeric/F
Exploit_Fixed <- 220
"
